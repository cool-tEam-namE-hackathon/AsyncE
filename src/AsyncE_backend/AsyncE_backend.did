import "./ws_types.did";

type User = record {
    username: text;
    profile_picture_blob: blob;
};

type Group = record {
    id: nat;
    name: text;
    users: vec text;
    owner: text;
    profile_picture_blob: blob;
};

type GroupQueryResponse = record {
    id: nat;
    name: text;
    users: vec text;
    owner: text;
};

type Video = record {
    id: nat;
    webcam_blob: blob;
    screen_blob: blob;
    created_time_unix: nat;
};

type VideoFrame = record {
    id: text;
    username: text;
    webcam_blob: blob;
    screen_blob: blob;
    created_time_unix: nat;
};

type Chat = record {
    id: nat;
    content: text;
    username: text;
    created_time_unix: nat;
};

type WebsocketEventMessageData = variant {
    Ping: null;
    GroupInvited: text;
    AddChat: Chat;
};

type WebsocketEventMessage = record {
    ty: text;
    data: WebsocketEventMessageData;
};

service : {
    get_user_credentials: () -> (opt text) query;
    register: (text) -> ();
    get_selfname: () -> (opt text) query;
    query_username: (text) -> (vec text) query;
    upload_profile_picture: (blob) -> ();
    get_profile_picture_size: () -> (nat) query;
    get_profile_picture_chunk_blob: (nat) -> (blob) query;

    create_group: (text) -> (nat);
    get_all_groups: () -> (vec GroupQueryResponse) query;
    get_group: (nat) -> (opt GroupQueryResponse) query;
    upload_group_profile_picture: (nat, blob) -> ();
    get_group_profile_picture_size: (nat) -> (nat) query;
    get_group_profile_picture_chunk_blob: (nat, nat) -> (blob) query;

    get_videos: (nat) -> (vec Video) query;
    create_video: (nat) -> (nat);
    upload_video: (nat, nat, blob, bool) -> ();
    concat_video: (nat, nat, blob, blob) -> ();

    invite_user: (nat, text) -> ();
    get_self_group_invites: () -> (vec nat) query;
    update_group_invite: (nat, bool) -> ();

    ws_open : (CanisterWsOpenArguments) -> (CanisterWsOpenResult);
    ws_close : (CanisterWsCloseArguments) -> (CanisterWsCloseResult);
    ws_message : (CanisterWsMessageArguments, opt WebsocketEventMessage) -> (CanisterWsMessageResult);
    ws_get_messages : (CanisterWsGetMessagesArguments) -> (CanisterWsGetMessagesResult) query;

    add_chat: (nat, text) -> ();
    get_chats: (nat) -> (vec Chat);
}
